<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>globalvar fntPixel;
fntPixel = font_add_sprite(sprFont, ord(" "), 0, 1)
globalvar fntLevel;
fntLevel = font_add_sprite(sprNumS, ord("."), 1, 2)
PLYNAME = ""
BTLPASS = ""
BTLID = 0
step = 0
msg = "Player name:"
sync = false
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.BattleID = BTLID
room_goto(rmBattleTest)
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>get[1] = http_get("http://" + global.host + "/request.php?rtype=checkready&amp;batid=" + string(BTLID) + "&amp;name=" + string(PLYNAME) )
sync = true
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="62">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if ds_map_find_value(async_load, "id") == get[0]
   {
   if ds_map_find_value(async_load, "status") &gt;= 0
      {
      r_str = ds_map_find_value(async_load, "result");
      
      if string_count("%conn_failed%", r_str)&gt;0 then
      {
        msg = "Connection failed."
        step+=1  
      }
      else if string_count("%notexist%", r_str)&gt;0
      {
        msg = PLYNAME + " not found.#(Make an account#first)"
        step+=1
      }
      else if string_count("%failcreate%", r_str)&gt;0
      {
        msg = "Failed to create battle.#Contact server admin."
        step+=1
      }
      else if string_count("%gamefull%", r_str)&gt;0
      {
        msg = "Game is full."
        step+=1
      }
      else if string_count("%failjoin%", r_str)&gt;0
      {
        msg = "Failed to join battle."
        step+=1
      }
      else if string_count("%nogame%", r_str)&gt;0
      {
        msg = "Battle not found#or wrong pass."
        step+=1
      }
      else
      {
        msg = serv_strdec(r_str)
        alarm[0] = room_speed*2
      }
      
      }
   else
      {
      r_str = "null";
      }
   }

if sync == true then {
if ds_map_find_value(async_load, "id") == get[1]
   {
   if ds_map_find_value(async_load, "status") &gt;= 0
      {
      r_str2 = ds_map_find_value(async_load, "result");
      if string_count("startgame%", r_str2)&gt;0 then
      {
        msg = "Starting..."
        //echo "$row[ID]%$row[Name]%$row[MAXHP]%$row[XP]%$row[XPMAX]%$row[Level]";
        global.myID = string_extract(r_str2, "%", 1)
        global.myName = string_extract(r_str2, "%", 2)
        global.myXP = real(string_extract(r_str2, "%", 4))
        global.myLevel = real(string_extract(r_str2, "%", 6))
        global.myMaxHP = round(25+global.myLevel+power(global.myLevel/1.4, 1.01))
        global.myMaxXP = round((power(global.myLevel,3)*(100-global.myLevel))/50)
        
        global.vsID = string_extract(r_str2, "%", 7)
        global.vsName = string_extract(r_str2, "%", 8)
        global.vsXP = real(string_extract(r_str2, "%", 10))
        global.vsLevel = real(string_extract(r_str2, "%", 12))
        global.vsMaxHP = round(25+global.vsLevel+power(global.vsLevel/1.4, 1.01))
        global.vsMaxXP = round((power(global.vsLevel,3)*(100-global.vsLevel))/50)
        
        global.myHP = real(global.myMaxHP)
        global.myHP_D = global.myHP
        global.vsHP = real(global.vsMaxHP)
        global.vsHP_D = global.vsHP
        
        global.myXP_D = global.myXP
        global.vsXP_D = global.vsXP
        
        global.playtype = "join"
        audio_play_music(sndBattle, true)
        alarm[1] = room_speed*5
      }
      else alarm[0] = room_speed*2

      }
   else
      {
      alarm[0] = room_speed*2
      r_str2 = "null";
      }
   }
}

   
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_set_halign(fa_left)
draw_set_valign(fa_top)
draw_set_font(fntPixel)
draw_border(sprGUI_green, 0, 0, 15, 1, 1)
draw_border(sprGUI_redbor, 0, 3, 12, 6, 1)
draw_pixeltext(1, 1, "JOIN BATTLE", c_white, c_black, 0, 0)
draw_pixeltext(1, 4, "PLAYER:", c_black, c_ltgray, 0, 0)
draw_pixeltext(1, 5, string(PLYNAME), c_blue, c_ltgray, 0, 0)
draw_pixeltext(1, 6, "BATTLE ID:", c_black, c_ltgray, 0, 0)
if BTLID&gt;0 then draw_pixeltext(1, 7, string(BTLID), c_blue, c_ltgray, 0, 0)
draw_pixeltext(1, 8, "PASSWORD:", c_black, c_ltgray, 0, 0)
draw_pixeltext(1, 9, string(BTLPASS), c_blue, c_ltgray, 0, 0)

if step&gt;2 then {
    draw_set_color(c_white)
    draw_set_alpha(0.5)
    draw_rectangle(0,0,room_width, room_height, false)
    draw_set_alpha(1)
}

draw_set_halign(fa_center)
draw_set_valign(fa_middle)
draw_set_font(fntPixel)
draw_set_color(c_black)
draw_text_color(room_width/2+4+1, room_height/2+1+16, string(" ") + msg, c_ltgray, c_ltgray, c_ltgray, c_ltgray, 0.7)
draw_text(room_width/2+4, room_height/2+16, string(" ") + msg)
draw_set_color(c_blue)
draw_text_color(room_width/2+4+1, room_height/2+1+8+16, keyboard_string, c_ltgray, c_ltgray, c_ltgray, c_ltgray, 0.7)
draw_text(room_width/2+4, room_height/2+8+16, keyboard_string)

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="9" enumb="13">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if step==0 then {
PLYNAME += keyboard_string
keyboard_string = ""
msg = "Battle ID:"
step+=1
}
else if step==1 then {
BTLID += real(keyboard_string)
keyboard_string = ""
msg = "Battle password:"
step+=1
}
else if step==2 then {
BTLPASS += keyboard_string
keyboard_string = ""
get[0] = http_get("http://" + global.host + "/request.php?rtype=joinbattle&amp;name=" + string(PLYNAME) + string("&amp;pass=") + string(BTLPASS) + string("&amp;batid=") + string(BTLID) )
msg = "Contacting server..."
instance_create(0,0,objLoading)
step+=1
}
else if step==4 then {
room_restart()
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
